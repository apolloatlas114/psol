<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSOL Game - 3D Agar.io</title>

    <!-- ✅ Externe CSS-Datei -->
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

    <!-- ✅ Name Input Field (Must Enter Before Playing) -->
    <div id="nameEntry">
        <input type="text" id="playerNameInput" placeholder="Enter your name">
        <button id="joinGameButton">Join Game</button>
    </div>

    <!-- ✅ Canvas for the game (Initially hidden) -->
    <canvas id="gameCanvas" style="display: none;"></canvas>

    <!-- ✅ HUD for Score, Timer & Leaderboard -->
    <div id="hud" style="display: none;"> <!-- HUD also hidden until game starts -->
        <div id="timer" class="hud">
            <span class="hud-label">TIME:</span> <span class="hud-value">20:00</span>
        </div>
        <div id="score" class="hud">
            <span class="hud-label">SCORE:</span> <span class="hud-value" id="scoreCounter">0</span>
        </div>
        <div id="poolMoney" class="hud">
            <span class="hud-label">POOL:</span> <span class="hud-value" id="poolAmount">$0</span>
        </div>

        <div id="leaderboard" class="hud">
            <h3>TOP 10</h3>
            <ol id="leaderboard-list"></ol>
        </div>
    </div>

    <!-- ✅ Correct Three.js import -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@latest/build/three.module.js"
        }
    }</script>

    <!-- ✅ Correct WebSocket script source -->
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.5.4/dist/socket.io.min.js"></script>

    <!-- ✅ Multiplayer Initialization (Waits for Player Name) -->
    <script>
        let socket; // Declare globally

        document.getElementById("joinGameButton").addEventListener("click", function () {
            let username = document.getElementById("playerNameInput").value.trim();
            
            if (!username) {
                alert("⚠️ Please enter a valid name before joining!");
                return;
            }

            localStorage.setItem("playerName", username); // ✅ Save the name for session persistence

            // ✅ Show game canvas & HUD after name is entered
            document.getElementById("nameEntry").style.display = "none";
            document.getElementById("gameCanvas").style.display = "block";
            document.getElementById("hud").style.display = "block";

            // ✅ Initialize WebSocket only AFTER the name is set
            socket = io("https://psolgame-e77454844bbd.herokuapp.com/");
            
            // ✅ Send the player name to the server
            socket.emit("playerJoin", { username });

            // ✅ Listen for leaderboard updates
            socket.on("updateLeaderboard", (leaderboard) => {
                let leaderboardElement = document.getElementById("leaderboard-list");
                leaderboardElement.innerHTML = leaderboard
                    .map((player, index) => `<li>#${index + 1}: ${player.name} - ${Math.floor(player.score)}</li>`)
                    .join("");
            });

            // ✅ Load game scripts only after player joins
            setTimeout(() => {
    console.log("✅ Loading game scripts after HUD is visible...");
    import("./game.js");
    import("./multiplayer.js");
}, 500); // Wait 500ms to ensure HUD is displayed

        });
    </script>

</body>
</html>
